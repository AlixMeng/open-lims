<script>
/*<![CDATA[*/
$(document).ready(function()
{
	var line_counter = 1;
	var limit_array = new Array();
	var limit_counter = 0;
	var current_limit = 0;
	
	limit_array[limit_counter] = new Object();
	limit_array[limit_counter]['name'] = "First Limit";
	limit_array[limit_counter]['usl'] = new Array();
	limit_array[limit_counter]['lsl'] = new Array();
	
	// New Template Line
	$("#DataParameterTemplateFieldNewButton").click(function()
	{
		line_counter++;
		
		if ($("#DataParameterTemplateTable").children("tbody").children(":last-child").hasClass("odd"))
		{
			var tr_class = "even";	
		}
		else
		{
			var tr_class = "odd";	
		}
		
		$("#DataParameterTemplateTable").children("tbody").children(":last-child").after("<tr class='"+tr_class+" DataParameterTemplateField' id='DataParameterTemplateField"+line_counter+"'>" +
			"<td><input type='text' name='name-"+line_counter+"' class='DataParameterAdminValue' /></td>" +
			"<td>" +
			"<select class='DataParameterMeasuringUnitSelect DataParameterAdminValue' name='unit-"+line_counter+"'>" +
			"" +
			"<!-- FOREACH BEGIN ([[MEASURING_UNITS]]) -->" +
			"" +
			"	<option value='[[MEASURING_UNITS:VALUE]]' [[MEASURING_UNITS:DISABLED]] [[MEASURING_UNITS:SELECTED]]>[[MEASURING_UNITS:CONTENT]]</option>" +
			"" +
			"<!-- FOREACH END -->" +
			"" +
			"</select>" +
			"</td>" +
			"<td><input type='text' size='6' name='usl-"+line_counter+"' class='DataParameterAdminValue' /></td>" +
			"<td><input type='text' size='6' name='lsl-"+line_counter+"' class='DataParameterAdminValue' /></td>" +
			"<td><input type='text' size='6' name='min-"+line_counter+"' class='DataParameterAdminValue' /></td>" +
			"<td><input type='text' size='6' name='max-"+line_counter+"' class='DataParameterAdminValue' /></td>" +
			"<td>Methods</td>" +
			"<td><a title='delete' style='cursor: pointer;' id='DataParameterTemplateFieldDeleteButton"+line_counter+"'><img src='images/icons/delete.png' alt='D' /></a></td>" +
			"</tr>");
		
		$("#DataParameterTemplateFieldDeleteButton"+line_counter+"").click(function()
		{
			var current_line_counter = $(this).attr("id").replace("DataParameterTemplateFieldDeleteButton","");
			
			$(this).parent().parent().fadeOut(400, function()
			{
				$(this).remove();

				var tmp_delete_counter = 1;
				
				$(".DataParameterTemplateField").each(function()
				{
					if ((tmp_delete_counter % 2) !== 0)
					{
						var tmp_tr_class = "even";	
					}
					else
					{
						var tmp_tr_class = "odd";	
					}
					
					$(this).removeClass("odd");
					$(this).removeClass("even");
					$(this).addClass(tmp_tr_class);
					
					tmp_delete_counter++;
				});
			});
		});
		
		base_form_init();
	});
	
	// Limit Dialog
	$("#DataParameterAdminTemplateLimitsDialog").dialog(
	{
		autoOpen: false,
		height: 400,
		width: 530,
		buttons: 
		{
			"[[LANG:BaseGlobalButtonClose]]": function()
			{
			 	$(this).dialog("close");
			 	$("#DataParameterAdminTemplateLimitsDialogSelect select").trigger("onchange");
			 	$("#DataParameterTemplateTable tbody tr").each(function()
	 			{
			 		var id = $(this).attr("id").replace("DataParameterTemplateField","");
	 				$(this).children().children("input[name='usl-"+id+"']").val(limit_array[0]['usl'][id]);
	 				$(this).children().children("input[name='lsl-"+id+"']").val(limit_array[0]['lsl'][id]);
	 			});
			}
		}
	});
	
	// New Limit
	$("#DataParameterAdminTemplateLimitsDialogNew").dialog(
	{
		autoOpen: false,
		height: 150,
		width: 350,
		buttons: 
		{
			"[[LANG:BaseGlobalButtonNew]]": function()
			{
			 	$(this).dialog("close");
			 	
			 	var name = $(this).find('input').val();
			 	
			 	limit_counter++;
			 	limit_array[limit_counter] = new Object();
			 	limit_array[limit_counter]['name'] = name;
			 	limit_array[limit_counter]['usl'] = new Array();
			 	limit_array[limit_counter]['lsl'] = new Array();
			 	
			 	var new_option = $("<option value='"+limit_counter+"'>"+name+"</option>")
			 	$("#DataParameterAdminTemplateLimitsDialogSelect select").append(new_option);
			 	$(new_option).attr("selected", "selected");
			 	
			 	base_form_init();
			 	
			 	$("#DataParameterAdminTemplateLimitsDialogSelect select").trigger("onchange");
			},
			"[[LANG:BaseGlobalButtonCancel]]": function()
			{
			 	$(this).dialog("close");
			}
		}
	});
	
	// Delete Limit
	$("#DataParameterAdminTemplateLimitsDialogDelete").dialog(
	{
		autoOpen: false,
		height: 150,
		width: 350,
		buttons: 
		{
			"[[LANG:BaseGlobalButtonYes]]": function()
			{
			 	$(this).dialog("close");
			 	
			 	limit_array[limit_counter] = undefined;
			 	
			 	$("#DataParameterAdminTemplateLimitsDialogSelect select").find("option:selected").remove();
				$("#DataParameterAdminTemplateLimitsDialogSelect select").find("option[value='0']").attr("selected", "selected");
			 	
			 	base_form_init();
			 	
			 	$("#DataParameterAdminTemplateLimitsDialogSelect select").trigger("onchange");
			},
			"[[LANG:BaseGlobalButtonNo]]": function()
			{
			 	$(this).dialog("close");
			}
		}
	});
	
	// Rename Limit
	$("#DataParameterAdminTemplateLimitsDialogRename").dialog(
	{
		autoOpen: false,
		height: 150,
		width: 350,
		buttons: 
		{
			"[[LANG:BaseGlobalButtonSave]]": function()
			{
			 	$(this).dialog("close");
			 	
			 	var name = $(this).find('input').val();
			 	
			 	limit_array[current_limit]['name'] = name;
			 	
			 	$("#DataParameterAdminTemplateLimitsDialogSelect select").find("option:selected").html(name);
			 	
			 	base_form_init();
			},
			"[[LANG:BaseGlobalButtonCancel]]": function()
			{
			 	$(this).dialog("close");
			}
		}
	});
	
	// Limit Select Change
	$("#DataParameterAdminTemplateLimitsDialogSelect select").bind("onchange", function()
	{
		if (limit_array[current_limit] !== undefined)
		{
			$(".DataParameterAdminLimitValue").each(function()
			{
				if ($(this).is("input"))
				{
					var name = $(this).attr("name");
					
					if (name.indexOf("usl-") !== -1)
					{
						name = parseInt(name.replace("usl-",""));
						limit_array[current_limit]['usl'][name] = $(this).val();
					}
					else if (name.indexOf("lsl-") !== -1)
					{
						name = parseInt(name.replace("lsl-",""));
						limit_array[current_limit]['lsl'][name] = $(this).val();
					}
				}
			});
		}
		
		current_limit = $(this).children("option:selected").val();
		
		$(".DataParameterAdminLimitValue").each(function()
		{
			if ($(this).is("input"))
			{
				var name = $(this).attr("name");
				
				if (name.indexOf("usl-") !== -1)
				{
					name = parseInt(name.replace("usl-",""));
					$(this).val(limit_array[current_limit]['usl'][name]);
				}
				else if (name.indexOf("lsl-") !== -1)
				{
					name = parseInt(name.replace("lsl-",""));
					$(this).val(limit_array[current_limit]['lsl'][name]);
				}
			}
		});
		
		console.log(limit_array);
	});
	
	// Open Limit Dialog
	$("#DataParameterTemplateLimitButton").click(function()
	{
		$("#DataParameterAdminTemplateLimitsDialogNewButton").click(function()
		{
			$("#DataParameterAdminTemplateLimitsDialogNew").find('input').val("");
			$("#DataParameterAdminTemplateLimitsDialogNew").dialog("open");
		});
		
		$("#DataParameterAdminTemplateLimitsDialogRenameButton").click(function()
		{
			$("#DataParameterAdminTemplateLimitsDialogRename").find('input').val(limit_array[current_limit]['name']);
			$("#DataParameterAdminTemplateLimitsDialogRename").dialog("open");	
		});
		
		$("#DataParameterAdminTemplateLimitsDialogDeleteButton").click(function()
		{
			$("#DataParameterAdminTemplateLimitsDialogDelete").dialog("open");	
		});
		
		// var number_of_entries = $("#DataParameterTemplateTable tbody tr").length;
				
		$("#DataParameterTemplateLimitTable tbody").empty();
		$("#DataParameterTemplateTable tbody tr").each(function()
		{
			var id = $(this).attr("id").replace("DataParameterTemplateField","");
			var name = $(this).children(":first-child").children("input").val();
			var usl = $(this).children().children("input[name='usl-"+id+"']").val();
			var lsl = $(this).children().children("input[name='lsl-"+id+"']").val();
			
			if ((name === undefined) || (name === ""))
			{
				name = "Field "+id;	
			}
						
			$("#DataParameterTemplateLimitTable tbody").append("<tr>" +
			"<td>"+name+"</td>" +
			"<td><input type='text' size='6' name='usl-"+id+"' class='DataParameterAdminLimitValue' value='"+usl+"' /></td>" +
			"<td><input type='text' size='6' name='lsl-"+id+"' class='DataParameterAdminLimitValue' value='"+lsl+"' /></td>" +
			"</tr>");
		});
		
		$("#DataParameterAdminTemplateLimitsDialogSelect select").find("option:selected").attr("selected", false);
		$("#DataParameterAdminTemplateLimitsDialogSelect select").find("option[value=0]").attr("selected", "selected");
		
		current_limit = 0;
		
		base_form_init();
		
		$("#DataParameterAdminTemplateLimitsDialog").dialog("open");
	});
	
	// Cancel Template Admin
	$("#DataParameterTemplateCancelButton").click(function()
	{
		history.back();
	});
	
	// Save Template Admin
	$("#DataParameterTemplateSaveButton").click(function()
	{
		var field_object = new Object();
		
		$(".DataParameterAdminValue").each(function()
		{
			var name = $(this).attr("name");
			if (name !== undefined)
			{
				var type = name.split("-")[0];
				var id = parseInt(name.split("-")[1]);
				var value = $(this).val();

				if ((type !== "lsl") && (type !== "usl"))
				{
					if (field_object[id] === undefined)
					{
						field_object[id] = new Object();
					}
					
					field_object[id][""+type+""] = value;
				}
			}
		});
		
		var json_field_object = JSON.stringify(field_object);
		var json_limit_object = JSON.stringify(limit_array);
		
		if ($("input[name='name']").val() === "")
		{
			return;
		}
		else
		{
			var name = $("input[name='name']").val();
		}
		
		if ($("input[name='internal_name']").val() === "")
		{
			return;
		}
		else
		{
			var interal_name = $("input[name='name']").val();
		}
		
		$.ajax(
		{
			type : "POST",
			url : "ajax.php?session_id=[[SESSION_ID]]&nav=data&run=admin_add_parameter_template",
			data : "name="+name+"&internal_name="+interal_name+"&json_object_string="+json_field_object+"&json_limit_string="+json_limit_object,
			beforeSend: function()
			{
				$("#DataParameterAdminTemplateAddFinish").dialog("open");
			},
			success : function(data)
			{
				if (data == "1")
				{
					// window.setTimeout('window.location = \'[[RETRACE]]\'',500);
				}
				else
				{
					if ((data + '').indexOf("EXCEPTION",0) === 0)
					{
						var exception_message = data.replace("EXCEPTION: ","");
						$("#DataParameterAdminTemplateAddFinish").dialog("close");
						ErrorDialog("Error", exception_message);
						return false;
					}
					else
					{
						$("#DataParameterAdminTemplateAddFinish").dialog("close");
						ErrorDialog("Error", "An error occured");
						return false;
					}
				}
			}
		});
	});
	
});
/*]]>*/  
</script>

<div class="BasePlaseWaitWindow" id="DataParameterAdminTemplateAddFinish" title=""> 
<div><img src='images/animations/loading_circle_small.gif' alt=''> [[LANG:BaseGlobalMessageWait]]</div>
</div> 

<div id="DataParameterAdminTemplateLimitsDialog" title="Limits (USL/LSL)">
	<div id="DataParameterAdminTemplateLimitsDialogSelect" class="Form"><select><option value='0'>First Limit (Initial-Limit)</option></select></div>
	<div id="DataParameterAdminTemplateLimitsDialogButtons">
		<a href='#' class='ListButton' id='DataParameterAdminTemplateLimitsDialogNewButton'>
		<img src='images/icons/add.png' alt='' />
		<div>New Limit</div>
		</a>
		<a href='#' class='ListButton' id='DataParameterAdminTemplateLimitsDialogRenameButton'>
		<img src='images/icons/delete.png' alt='' />
		<div>Rename current Limit</div>
		</a>
		<a href='#' class='ListButton' id='DataParameterAdminTemplateLimitsDialogDeleteButton'>
		<img src='images/icons/delete.png' alt='' />
		<div>Delete current Limit</div>
		</a>
	</div>
	<div style='clear: both;' id="" class="Form">
		<table style='width: 100%; text-align: left;' id="DataParameterTemplateLimitTable">
			<thead>
				<tr>
					<th>Name</th>
					<th>USL (max)</th>
					<th>LSL (max)</th>
				</tr>
			</thead>
			<tbody>
			</tbody>
		</table>
	</div>
</div> 

<div id="DataParameterAdminTemplateLimitsDialogNew" title="New Limit" class='Form'>
Name: <input type='text' size='35' />
</div>

<div id="DataParameterAdminTemplateLimitsDialogDelete" title="Delete Limit">
Are you sure?
</div>

<div id="DataParameterAdminTemplateLimitsDialogRename" title="Rename Limit">
Name: <input type='text' size='35' />
</div>


<!-- CONTAINER BEGIN ("Add Parameter Template") -->

<div class='Form'>

<div class='FormBox'>
<div class='FormBoxHeadline'>Parameter Template Details</div>

<table style='width: 80%'>
	<tr>
		<td>Name:</td>
		<td><input type='text' name='name' /></td>
		<td>Internal-Name:</td>
		<td><input type='text' name='internal_name' /></td>
	</tr>
</table>

</div>


<div class='FormBoxWithoutLRPadding'>
<div class='FormBoxHeadlineWithoutLRPadding'>Parameter-Fields</div>

<table style='width: 100%; text-align: left;' id='DataParameterTemplateTable' class='DataParameterTable'>
	<thead>
		<tr>
			<th>Name</th>
			<th>Unit</th>
			<th>USL (max)</th>
			<th>LSL (min)</th>
			<th>Min (valid)</th>
			<th>Max (valid)</th>
			<th>Methods</th>
			<th style='width: 20px;'></th>
		<tr>
	</thead>
	<tbody>
		<tr class='odd' id='DataParameterTemplateField1'>
			<td><input type='text' name='name-1' class='DataParameterAdminValue' /></td>
			<td>
				<select class='DataParameterMeasuringUnitSelect DataParameterAdminValue' name='unit-1'>
				
				<!-- FOREACH BEGIN ([[MEASURING_UNITS]]) -->
	
					<option value='[[MEASURING_UNITS:VALUE]]' [[MEASURING_UNITS:DISABLED]] [[MEASURING_UNITS:SELECTED]]>[[MEASURING_UNITS:CONTENT]]</option>
		
				<!-- FOREACH END -->
				
				</select>
			</td>
			<td><input type='text' size='6' name='usl-1' class='DataParameterAdminValue' /></td>
			<td><input type='text' size='6' name='lsl-1' class='DataParameterAdminValue' /></td>
			<td><input type='text' size='6' name='min-1' class='DataParameterAdminValue' /></td>
			<td><input type='text' size='6' name='max-1' class='DataParameterAdminValue' /></td>
			<td>Methods</td>
			<td></td>
		</tr>
	</tbody>
</table>

<br />

<div style='padding: 0 10px;'>
<button type='submit' id='DataParameterTemplateFieldNewButton'>New Field</button>
<button type='submit' id='DataParameterTemplateLimitButton'>Limits (USL/LSL)</button>
<div class='FormButtonBoxClear'></div>
</div>
</div>

<div class='FormButtonBox'>
<button type='submit' id='DataParameterTemplateSaveButton'>Save</button>
<button type='submit' id='DataParameterTemplateCancelButton'>Cancel</button>
<div class='FormButtonBoxClear'></div>
</div>
</div>

<!-- CONTAINER END () -->