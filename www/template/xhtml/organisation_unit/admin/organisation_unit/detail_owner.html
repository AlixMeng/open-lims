<script>
$(document).ready(function()
{
	var get_array = getQueryParams(document.location.search);
	
	function load_content(sortvalue, sortmethod, page)
	{
		$.ajax(
		{
			type: "GET",
			url: "core/modules/organisation_unit/ajax/admin/admin_organisation_unit.ajax.php",
			data: "session_id="+get_array['session_id']+"&run=list_owners&organisation_unit_id=[[ORGANISATION_UNIT_ID]]&sortvalue="+sortvalue+"&sortmethod="+sortmethod+"&page="+page,
			success: function(data)
			{
				$("#OrganisationUnitAdminAjaxContent").contents().detach();
				$("#OrganisationUnitAdminAjaxContent").append(data);
			}
		});
	}
	
	var sortvalue = "";
	var sortmethod = "";
	var page = 0;
	
	load_content(sortvalue, sortmethod, page);
	
	var name_sortmethod = "asc";
	
	$("#OrganisationUnitAdminListSortUsername").live('click', function()
	{
		sortvalue = "username";
		
		load_content(sortvalue, name_sortmethod, page);
		
		if (name_sortmethod == "asc")
		{
			name_sortmethod = "desc";
			sortmethod = "asc";
		}
		else
		{
			name_sortmethod = "asc";
			sortmethod = "desc";
		}

	});
	
	var user_sortmethod = "asc";
	
	$("#OrganisationUnitAdminListSortFullname").live('click', function()
	{
		
		sortvalue = "fullname";
		
		load_content(sortvalue, user_sortmethod, page);
		
		if (user_sortmethod == "asc")
		{
			user_sortmethod = "desc";
			sortmethod = "asc";
		}
		else
		{
			user_sortmethod = "asc";
			sortmethod = "desc";
		}
		
	});

	$(".OrganisationUnitAdminListPage").each().live('click', function()
	{
		var id = $(this).attr("id");
		page = id.replace("OrganisationUnitAdminListPage","");
		load_content(sortvalue, sortmethod, page);
	});
	
	$(".OrganisationUnitAdminListDelete").each().live('click', function()
	{
		var id = $(this).attr("id");
		id = id.replace("OrganisationUnitAdminListDelete","");
		$.ajax(
		{
			type: "GET",
			url: "core/modules/organisation_unit/ajax/admin/admin_organisation_unit.ajax.php",
			data: "session_id="+get_array['session_id']+"&run=delete_owner&organisation_unit_id=[[ORGANISATION_UNIT_ID]]&user_id="+id,
			success: function(data)
			{
				if (data == 1)
				{
					load_content(sortvalue, sortmethod, page);
				}
			}
		});
	});
	
	$('#OrganisationUnitAdminUserAdd').click(function()
	{
		$("#UserSelectDialog").dialog("open");
		$("#UserSelectDialogSearchField").val("");
		return false;
	});
	
	$("#UserSelectDialog").bind( "dialogbeforeclose", function(event, ui) 
	{
		if ($("#UserSelectDialogOK").html() == "true")
		{
			var user_id = $("#UserSelectDialogSelect option:selected").attr("id");
			
			if (user_id != undefined)
			{
				user_id = user_id.replace("User","");
				
				$.ajax(
				{
					type: "GET",
					url: "core/modules/organisation_unit/ajax/admin/admin_organisation_unit.ajax.php",
					data: "session_id="+get_array['session_id']+"&run=add_owner&organisation_unit_id=[[ORGANISATION_UNIT_ID]]&user_id="+user_id,
					success: function(data)
					{
						if (data == 1)
						{
							load_content(sortvalue, sortmethod, page);
						}
					}
				});
			}
		}
	});

});
</script>

[[ADD_DIALOG]]

<br />

<!-- CONTAINER BEGIN ("Owners [[TITLE]]") -->

<div class='boxIconBar'>
				
<div class='boxIcon'><img src='images/icons/add.png' alt='' />&nbsp;<a href='#' id='OrganisationUnitAdminUserAdd'>Add an Owner</a></div>

</div>

<div id='OrganisationUnitAdminAjaxContent'>


</div>

<!-- CONTAINER END () -->